---
title: 'Essay 6: Time series Volatility and ARCH Modeling'
author: "Dhruvi, Vi, Huy, Harshal"
date: "4/26/2021"
output: html_document
---

## (1) INTRODUCTION

### ARCH modeling 


### Loading R packages

```{r, results=FALSE, warning=FALSE, message=FALSE}
library("dplyr")
library("stats")
library("GGally")
library("ggpubr")
library("readr")
library("tidyverse") #for data manipulation and visualization

library("grid")
library("gridExtra")
library("kableExtra")
library("knitr")
library("dynlm")
library("FinTS")
library("fGarch")
```

## (2) DATA DESCRIPTION

### Examples of data and problem

**Bitcoin USD Yahoo Finance**

We will use the Historical prices of Bitcoin in USD at a daily frequency from the beginning of 2021 to April 19, 2021.

Source: https://finance.yahoo.com/quote/BTC-USD/history?p=BTC-USD

*The objective is to use the ARCH model to measure the volatility in the Bitcoin USD time-series data.*

**Importing the data file**

```{r, echo=TRUE, results='hide'}
BTCN <- read.csv("BTC-USD.csv")
```

### Visualization

Let us examine the daily closing prices of Bitcoin USD stocks. The closing price is the stock price you see when the stock market closes. A stock's closing price is the standard benchmark used by investors to track its performance over time. 

Below we plot the closing time against each day in time period (Jan. 1, 2021 - April 19, 2021). We also plot a histogram.

```{r}
BTCN$Close <- ts(BTCN$Close)
BTCN$Date <- seq.Date(as.Date('2021-01-01'), by = 'day', length.out = length(BTCN$Close))

ggplot(BTCN, aes(y = Close, x = Date)) + geom_line(col = 'red') +
  labs(title = 'BTC Daily Closing Value', y = 'Closing price')

hist(BTCN$Close, main="", breaks=20, freq=FALSE, col="grey", xlab = "closing price") 
```


## (3) ANALYSIS

### Computation of ARCH 1 model

To perform the test for ARCH effects, we must

+ Estimate a mean equation that, in this example, is $r_t=β_0+e_t$
+ Retrieve the estimated residuals $\hat{e}_t$
+ Estimate (1.3).

```{r}
# Step 1: Estimate mean equation r = beta + error
BTCN.mean <- dynlm(Close ~ 1, data = BTCN)

# Step 2: Retrieve the residuals from the former model and square them
ehatsq <- ts(resid(BTCN.mean)^2)

# Step 3: regress squared residuals on one-lagged squared residuals
BTCN.arch <- dynlm(ehatsq ~ L(ehatsq), data = ehatsq)

summary(BTCN.arch)
```

We can check for ARCH effects by using the ArchTest() function from the FinTS package. We will use a significance level of $\alpha=0.05$ for our null hypothesis test.

```{r}
byd.archTest <- ArchTest(BTCN$Close, lags = 1, demean = TRUE)
byd.archTest
```
Because the p-value is < 0.05, we reject the null hypothesis and conclude the presence of ARCH(1) effects.
  
**Estimating ARCH Models**

We can estimate an ARCH(1) model using the garchFit() function from the fGarch package in R. Specifically, we need to estimate the variance given in equation (1.2c). ARCH models are estiamted using the maximum likelihood method.

```{r}
arch.fit <- garchFit(~garch(1,0), data = BTCN$Close, trace = F)
summary(arch.fit)

```
Based on the output, the estimated mean of the series is

\[\hat{r}_t=\hat{\beta}_0=19.502\]

and the estimated variance is

\[\hat{h}_t=\hat{\alpha}_0+\hat{\alpha}_1\hat{e}^{2}_{t−1}=13.6063+24.6636=38.2699\]


Plotting the conditional variance looks something like

```{r}
BTCN$ht <- arch.fit@h.t
ggplot(BTCN, aes(y = ht, x = Date)) + geom_line(col = '#ff9933') + ylab('Conditional Variance') + xlab('Date')

```
Look at the graph, we can see that Jan and Feb have high volatatility.

## (4) MODEL EVALUATION

### Prediction and Model accuracy

In order to predict the stock prices of the Bitcoin in USD using our model. We use the **GARCH prediction function predict()**. 
It takes in the following parameters : 

1. object (arch.fit) : an object of class fGARCH as returned by the function garchFit. 
2. n.ahead (2) : an integer value, denoting the number of steps to be forecasted, by default 10. 
3. mse (cond) : If set to "cond", it states the it has conditional mean errors.
4. plot (T) : When set to "True", the confidence levels are computed and plotted. 

```{r}

predict(arch.fit, n.ahead = 5, mse ="cond", plot = T)

```

## (5) CONCLUSION

### Summary



## (6) REFERENCES

 https://github.com/ccolonescu/PoEdata
 
 https://finance.yahoo.com/quote/BTC-USD?p=BTC-USD
 
 https://rpubs.com/cyobero/arch
 
 https://bookdown.org/ccolonescu/RPoE4/time-varying-volatility-and-arch-models.html
 